\chapter{Lagrange and Euler-Lagrange mechanics}
In this section we will discuss the main possible formulations of classical mechanics and their derivations. We also want to note that all the formulations are derived from Newton's equations and so they are completely equivalent to them if the conditions for their validity are satisfied.
\section{Lagrange equations}
Going back to \dalambertref, expressing in generalized coordinates:
\begin{equation}
    \bigsum_i \brackets{\vec{F}^{\cancel{(a)}}_i - \dvec{p}_i} \cdot \delta \vec{r}_i = 0
\end{equation}
We drop the (a) term for an easier notation, from now on we will write $\vec{F}_i$ knowing that we are indicating the applied force.
\begin{equation}
    \delta \vec{r}_i = \bigsum_{\alpha} \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} \delta q_{\alpha} + \crossout{\dfrac{\partial \vec{r}_i}{\partial t} \dd{t}}
\end{equation}
The partial derivative over time is zero since we are considering a fixed moment in time. The force term in \dalambertref\;becomes:
\begin{equation}
    \bigsum_i \vec{F}_i \cdot \bigsum_{\alpha} \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} \delta q_{\alpha} = \bigsum_{\alpha}\underbrace{\bigsum_{i} \vec{F}_i \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}}_{Q_{\alpha}} \delta q_{\alpha} = \bigsum_{\alpha}Q_{\alpha}\delta q_{\alpha}
\end{equation}
The terms $Q_{\alpha}$ are called \textbf{generalized components of the forces}.
Now let's consider the expression $\bigsum_i \dvec{p}_i \cdot \delta \vec{r}_i$. We know that:
\begin{itemize}
    \item $\dvec{p}_i = \dv{}{t}\brackets{m_i\vec{v_i}}$
    \item $\delta \vec{r}_i = \bigsum_{\alpha} \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\delta q_{\alpha}$
\end{itemize}
Now, from the product rule:
\begin{equation} \label{e:total_deriv}
    \dv{}{t}\brackets{m_i\vec{v_i} \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}} = \dv{}{t}\brackets{m_i\vec{v_i}}\cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} + m_i\vec{v_i} \cdot \dv{}{t}\brackets{\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}}
\end{equation}
From the last term we get:
\begin{equation}
    m_i\vec{v_i} \cdot \dv{}{t}\brackets{\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}} = m_i\vec{v_i} \cdot \bigsum_{\beta} \dfrac{\partial}{\partial \dot{q}_{\beta} }\brackets{\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}} q_{\beta} + \dfrac{\partial}{\partial t}\brackets{\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}} =
\end{equation}
\begin{equation} \label{e:funny_derivative_p1}
    = m_i\vec{v_i} \cdot \dfrac{\partial}{\partial q_{\alpha} }\underbrace{\left[\bigsum_{\beta} \dfrac{\partial \vec{r}_i}{\partial q_{\beta}} \dot{q}_{\beta} + \dfrac{\partial \vec{r}_i}{\partial t}\right]}_{\dvec{v}_i} = m_i\vec{v}_i \cdot \dfrac{\partial \vec{v}_i}{\partial q_{\alpha}}
\end{equation}
We now aim to prove that the partial derivative with respect to alpha in the first term in \eqref{e:total_deriv} is:
\begin{equation}
    \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} = \dfrac{\partial \vec{v}_i}{\partial \dot{q}_{\alpha}}
\end{equation}
Deriving what we got in \eqref{e:funny_derivative_p1} we get:
\begin{equation}
    \dfrac{\partial \vec{v}_i}{\partial \dot{q}_{\alpha}} = \dfrac{\partial }{\partial \dot{q}_{\alpha}} \brackets{\bigsum_{\beta}\dfrac{\partial \vec{r}_i}{\partial q_{\beta}} \dot{q}_{\beta} + \dfrac{\partial \vec{r}_i}{\partial t}} =
\end{equation}
\begin{equation}
     = \bigsum_{\beta}\dfrac{\partial \vec{r}_i}{\partial q_{\beta}} \underbrace{\dfrac{\partial \dot{q}_{\beta}}{\partial \dot{q}_{\alpha}}}_{\delta_{\alpha \beta}}  + \crossout{\dfrac{\partial }{\partial \dot{q}_{\alpha}}\brackets{\dfrac{\partial \vec{r}_i}{\partial t}}} = \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}
\end{equation}
Again, the first term of \eqref{e:total_deriv} can be rewritten as:
\begin{equation}
    \bigsum_i \dv{}{t}\brackets{m_i\vec{v_i} \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}} = \bigsum_i\dv{}{t}\brackets{m_i\vec{v_i} \cdot \dfrac{\partial \vec{v}_i}{\partial \dot{q}_{\alpha}}} = \dv{}{t}\left[\dfrac{\partial }{\partial \dot{q}_{\alpha}} \underbrace{\bigsum_i \brackets{\dfrac{1}{2}m_i \vec{v_i} \cdot \vec{v_i}}}_{T}\right]
\end{equation}
Similarly the last term in \eqref{e:total_deriv} is:
\begin{equation}
    \bigsum_im_i\vec{v}_i \cdot \dfrac{\partial \vec{v}_i}{\partial q_{\alpha}} = \dfrac{\partial }{\partial \dot{q}_{\alpha}} \underbrace{\bigsum_i \brackets{\dfrac{1}{2}m_i \vec{v_i} \cdot \vec{v_i}}}_{T}
\end{equation}
So we get:
\begin{equation}
    \bigsum_i \dv{}{t}\brackets{m_i\vec{v_i}}\cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} = \dv{}{t}\dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \dfrac{\partial T}{\partial q_{\alpha}}
\end{equation}
Going back to \dalambertref\;we get:
\begin{equation}
    \bigsum_i \brackets{\vec{F}_i - \dvec{p}_i} \cdot \delta \vec{r}_i = \bigsum_{\alpha}Q_{\alpha}\delta q_{\alpha} - \bigsum_i \dv{}{t}\brackets{m_i\vec{v_i}} \cdot \bigsum_{\alpha}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\delta q_{\alpha} =
\end{equation}
\begin{equation}
    = \bigsum_{\alpha}Q_{\alpha}\delta q_{\alpha} - \bigsum_{\alpha}\bigsum_i \dv{}{t}\brackets{m_i\vec{v_i}} \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\delta q_{\alpha} =
\end{equation}
\begin{equation}
    = \bigsum_{\alpha}Q_{\alpha}\delta q_{\alpha} - \bigsum_{\alpha}\brackets{\dv{}{t}\dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \dfrac{\partial T}{\partial q_{\alpha}}}\delta q_{\alpha} = 0
\end{equation}
All the terms are independent by construction so we get a set of equations which are called \textbf{Lagrange equations} $\heartsuit$:
\begin{equation} \label{Lagrange_equations}
    \boxed{\dv{}{t}\dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \dfrac{\partial T}{\partial q_{\alpha}} = Q_{\alpha}}
\end{equation}
which must be satisfied $\forall \alpha$s.
Here are some basic properties of \lagrangeref :
\begin{itemize}
    \item There is a minimum of $n$ equations to solve
    \item They are $2^\circ$ order differential equations, this means that for every equation we need 2 initial conditions
    \item There is a total of $2n$ total initial conditions
\end{itemize}
\section{Euler-Lagrange equations}
From \lagrangeref\;it is easy to derive another formulation. Suppose that every force is expressed through a potential:
\begin{equation}
    \vec{F}_i = -\nabla_i V
\end{equation}
Since $V$ (the total potential) must be a function of only the coordinates $V = V(\vec{r_i})$ we get that:
\begin{equation}
    Q_{\alpha} = \bigsum_i \vec{F}_i \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} = - \bigsum_i \nabla_i V \cdot \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} = -\partial{V}{q_{\alpha}}
\end{equation}
Rewriting \lagrangeref\;we get:
\begin{equation}
    \dv{}{t}\dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \dfrac{\partial T}{\partial q_{\alpha}} + \partial{V}{q_{\alpha}} = 0
\end{equation}
If the potential does not depend on the generalized velocities we can subtract its derivative with respect to $\dot{q}_{\alpha}$, which will just be 0:
\begin{equation}
    \dv{}{t}\dfrac{\partial }{\partial \dot{q}_{\alpha}}[\underbrace{T-V}_\lagr ] - \dfrac{\partial}{\partial q_{\alpha}}[\underbrace{T-V}_\lagr ] = 0
\end{equation}
We define the Lagrange function or \textbf{Lagrangian} as:
\begin{equation}
    agr  = T - V
\end{equation}
Finally we can write the \textbf{Euler-Lagrange equations}:
\begin{equation} \label{Euler_Lagrange_equations}
    \boxed{\dv{}{t}\pdv{\lagr}{\dot{q}_{\alpha}} = \pdv{\lagr}{q_{\alpha}}}
\end{equation}
Here are some basic properties of \eleref :
\begin{itemize}
    \item They are $2^\circ$ order differential equations
    \item There is a total of $2n$ total initial conditions
    \item $\lagr = \lagr(q_{\alpha},\dot{q}_{\alpha},t)$ which means we have $2n+1$ variables
    \item $[\lagr] = \mathrm{J}$ but the Lagrangian is not the mechanical energy, it is just a mathematical tool
    \item If $\lagr$ is a Lagrangian of the system then $\tilde{\lagr} = \lagr + \mathrm{constant}$ is still Lagrangian
    \item If $\lagr$ is a Lagrangian of the system and $F\in \mathcal{C}^1$ is an arbitrary function of \underline{coordinates and time} then $\tilde{\lagr} = \lagr + \partial_t F$ is a Lagrangian
\end{itemize}
If we have two system, let's call them $A$ and $B$ then the Lagrangian of the total system $AB$ in general \underline{is not}:
\begin{equation}
    \lagr_{AB} = T_A + T_B - V_A - V_B - \underbrace{V_{AB}}_{\text{interaction term}}\neq \lagr_A + \lagr_B
\end{equation}
but if the systems interact weakly then:
\begin{equation}
    \lagr_{AB} \approx \lagr_A + \lagr_B
\end{equation}
If the potential $V$ \underline{does not} depend on time explicitly then the system is conservative:
\begin{equation}
    \delta W = \bigsum_i \vec{F}_i \delta \vec{r}_i = \bigsum_i \vec{F}_i \bigsum_{\alpha}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\delta q_{\alpha} = \bigsum_{\alpha} Q_{\alpha}\delta q_{\alpha} =
\end{equation}
\begin{equation}
    = -\bigsum_{\alpha} \partial{V}{q_{\alpha}}\delta q_{\alpha} = -\dd{V}
\end{equation}
Instead if $V$ \underline{depends} on time explicitly we have that:
\begin{equation}
    \dd{V} = \bigsum_{\alpha} \partial{V}{q_{\alpha}}\delta q_{\alpha} + \dfrac{\partial V}{\partial t}\dd{t}
\end{equation}
The extra term appearing in $\dd{V}$ is not present in the expression for work, meaning that:
\begin{equation}
    W_{12} \neq -\int_{1}^{2}\dd{V} = V_1 - V_2
\end{equation}
so the system is not conservative.\\
In some cases (ex. Lorentz force) the force does not come from a "real" potential, we can then rewrite \eleref\;for a function called \textbf{generalized potential} $\mu$ such that:
\begin{equation}
    Q_{\alpha} = -\dfrac{\partial \mu}{\partial q_{\alpha}} +\dv{}{t}\dfrac{\partial \mu}{\partial \dot{q}_{\alpha}}
\end{equation}
Indeed, from \lagrangeref\;we get:
\begin{equation}
    \dv{}{t}\dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \dfrac{\partial T}{\partial q_{\alpha}} = -\dfrac{\partial \mu}{\partial q_{\alpha}} +\dv{}{t}\dfrac{\partial \mu}{\partial \dot{q}_{\alpha}}
\end{equation}
\begin{equation}
    \dv{}{t}\dfrac{\partial }{\partial \dot{q}_{\alpha}}[\underbrace{T-\mu}_L] - \dfrac{\partial}{\partial q_{\alpha}}[\underbrace{T-\mu}_L] = 0
\end{equation}
\begin{equation}
    \dv{}{t}\pdv{\lagr}{\dot{q}_{\alpha}} = \pdv{\lagr}{q_{\alpha}}
\end{equation}
where we defined a generalized Lagrangian $\lagr = T-\mu$. These are called \textbf{generalized Euler-Lagrange equations}.
\section{Derivation of Euler-Lagrange equations from Hamilton's principle}
A \textbf{monogenic system} is any system in which all the forces can be expressed through a (generalized) potential which depends on $q_{\alpha}$, $\dot{q}_{\alpha}$ and $t$.\\
\textbf{Configuration space} is the set of all $q_{\alpha}$s. It completly describes the position of each particle of the system at a givent ime which, indeed, is the \textit{configuration} of the system itself. We can imagine the configuration space as an $n$-dimensional space in which the axes are the various $q_{\alpha}$.
Since each $q_{\alpha}$ changes with respect to time, the system describes a curve in the configuration space.\\
Let us consider two instants of time $t_1$ and $t_2$:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{res/svg/leastactionpath.drawio}
    \caption{Path of least action}
    \label{fig:image9}
\end{figure}
Then \textbf{Hamilton's principle} states that:
\begin{quote} \label{q:Hamilton_principle_quote}
    The path followed by a monogenic system in configuration space between $t_1$ and $t_2$ is the one for which the action $S$ is stationary
\end{quote}
The action is defined as:
\begin{equation}
    S = \int_{t_1}^{t_2}\lagr(q_{\alpha},\dot{q}_{\alpha},t) \dd{t}
\end{equation}
The units for actions are $[S] = \mathrm{J\cdot s}$.\\S is a \underline{functional} which is a "number" that depends on $q_{\alpha}$. Saying that $S$ is stationary means that slightly changing the path does not change the action.\\
Now we aim to prove that the \hyperref[q:Hamilton_principle_quote]{Hamilton's principle} is true if and only if the \eleref\;are true.\\
\underline{Proof} H.P. $\Rightarrow$ E.L.E.\\
Let's give some conditions:
\begin{itemize}
    \item Call $\Gamma$ the real path
    \item Fix $t_1$ and $t_2$ but sligthly change the path in between
\end{itemize}
For the second point we need to change the real path of a small virtual displacement:
\begin{equation}
    q_{\alpha}(t) \longrightarrow q_{\alpha}(t) + \delta q_{\alpha}(t)
\end{equation}
However after varying the whole path, for the real path we get:
\begin{equation}
    \dot{q}_{\alpha} = \dfrac{\dd{q_{\alpha}}}{\dd{t}}
\end{equation}
for the changed path instead:
\begin{equation}
    \dot{q}_{\alpha} + \delta \dot{q}_{\alpha}(t) = \dv{}{t}\brackets{q_{\alpha}(t) + \delta q_{\alpha}(t)}
\end{equation}
\begin{equation}
    \cancel{\dot{q}_{\alpha}} + \delta \dot{q}_{\alpha}(t) = \cancel{\dot{q}_{\alpha}} + \dv{}{t}\brackets{\delta q_{\alpha}(t)}
\end{equation}
\begin{equation}
    \delta \dot{q}_{\alpha}(t) = \dv{}{t}\brackets{\delta q_{\alpha}(t)}
\end{equation}
Now let's evaluate the change on S and apply \hpquoteref\;which can be mathematically expressed as follows.\\\textbf{Hamilton's principle}:
\begin{equation} \label{e:Hamilton_principle}
    \delta S = 0
\end{equation}
For the real path:
\begin{equation}
    S = \int_{t_1}^{t_2}\lagr(q_{\alpha},\dot{q}_{\alpha},t) \dd{t}
\end{equation}
For the changed path:
\begin{equation}
    \tilde{S} = \int_{t_1}^{t_2}\lagr(q_{\alpha}+\delta q_{\alpha},\dot{q}_{\alpha} + \delta \dot{q}_{\alpha},t) \dd{t}
\end{equation}
And so we get:
\begin{equation}
    \delta S = \tilde{S} - S = \int_{t_1}^{t_2}\brackets{\lagr(q_{\alpha}+\delta q_{\alpha},\dot{q}_{\alpha} + \delta \dot{q}_{\alpha},t) - \lagr(q_{\alpha},\dot{q}_{\alpha},t)} \dd{t}
\end{equation}
The right-hand side of the equation basically has the numerator of the difference quotient:
\begin{equation}
    f'(x)h \sim f(x+h) - f(x)
\end{equation}
for arbitrarily small values of h, which in our case is the value of the virtual displacement $\delta$. Hence, we get:
\begin{equation}
    \delta S = \int_{t_1}^{t_2}\bigsum_{\alpha}\brackets{\pdv{\lagr}{q_{\alpha}}\delta q_{\alpha} + \pdv{\lagr}{\dot{q}_{\alpha}} \underbrace{\delta \dot{q}_{\alpha}}_{\frac{\dd{}}{\dd{t}}\delta q_{\alpha}}} \dd{t} = 0
\end{equation}
Let's evaluate the second using integration by parts:
\begin{equation}
    \int_{t_1}^{t_2}\bigsum_{\alpha}\pdv{\lagr}{\dot{q}_{\alpha}} \dv{}{t}\delta q_{\alpha} \dd{t} = \crossout{\bigsum_{\alpha}\pdv{\lagr}{\dot{q}_{\alpha}} \delta q_{\alpha}\bigg|_{t_1}^{t_2}} - \int_{t_1}^{t_2}\bigsum_{\alpha}\dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}} \delta q_{\alpha} \dd{t}
\end{equation}
The term cancelled is zero since the displacement is zero in $t_1$ and $t_2$ for hypotesis. Hence, we get:
\begin{equation}
    \int_{t_1}^{t_2}\bigsum_{\alpha}\pdv{\lagr}{q_{\alpha}}\delta q_{\alpha} \dd{t} - \int_{t_1}^{t_2}\bigsum_{\alpha}\dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}} \delta q_{\alpha} \dd{t} = 0
\end{equation}
Since all the $\delta q_{\alpha}$ are independent we can pick any index $k$ and say that all the virtual displacements are zero except for the $k$-displacement, and we get:
\begin{equation}
    \int_{t_1}^{t_2}\dfrac{\partial \lagr}{\partial q_{k}}\delta q_{k} \dd{t} - \int_{t_1}^{t_2}\dv{}{t}\brackets{\dfrac{\partial \lagr}{\partial \dot{q}_{k}}} \delta q_{k} \dd{t} = 0
\end{equation}
Now we need a result which is called \textbf{Fundamental Lemma of the calculus of variation} which states that:\\
Taking any continuous function $M\in\mathcal{C}^0([a,b])$ and any function $\eta \in \mathcal{C}^2([a,b])$ such that $\eta(a) = \eta(b) = 0$ then it is true that:
\begin{equation} \label{e:Fundamental_lemma_variation_calculus}
    \int_{a}^{b}M(x)\eta(x)\dd{x} = 0 \Rightarrow M(x) = 0
\end{equation}
For the proof of this lemma we refer to the section (TBD).\\
In our case \eqref{e:Fundamental_lemma_variation_calculus} is satisfied for:
\begin{equation}
    \int_{t_1}^{t_2}\underbrace{\left[\dfrac{\partial \lagr}{\partial q_{k}} - \dv{}{t}\brackets{\dfrac{\partial \lagr}{\partial \dot{q}_{k}}}\right]}_{M} \underbrace{\delta q_{k}}_{\eta} \dd{t} = 0
\end{equation}
Hence:
\begin{equation}
    \pdv{\lagr}{q_{\alpha}} - \dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}} = 0
\end{equation}
\begin{equation}
    \pdv{\lagr}{q_{\alpha}} = \dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}}
\end{equation}
For any arbitrary $\alpha$. Hence, we proved that \hpquotemath\;implies \eleref.\\
It's trivial to prove the opposite since, repeating the passages of the first proof we arrive to:
\begin{equation}
    \delta S = \int_{t_1}^{t_2}\bigsum_{\alpha}\left[\pdv{\lagr}{q_{\alpha}} - \dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}}\right] \delta q_{\alpha}
\end{equation}
But the terms in the brackets are all zero because of the \eleref. So we get:
\begin{equation}
    \delta S = 0
\end{equation}
Which is precisely \hpquotemath.\\
Now that we established the relations between the \eleref\;and the \hpquotemath\;we are ready to prove that if $\lagr$ is a Lagrangian:
\begin{equation}
    \tilde{\lagr} = \lagr + \dfrac{\dd{F}}{\dd{t}}
\end{equation}
is a Lagrangian for the system. Evaluating the action for both Lagrangians we get:
\begin{equation}
    \tilde{S} = \int_{t_1}^{t_2}\lagr \dd{t} + \int_{t_1}^{t_2}\dfrac{\dd{F}}{\dd{t}} \dd{t}
\end{equation}
\begin{equation}
    S = \int_{t_1}^{t_2}\lagr \dd{t}
\end{equation}
The difference of action for the new Lagrangian is:
\begin{equation}
    \delta \tilde{S} = \int_{t_1}^{t_2}\dfrac{\dd{F}}{\dd{t}} \dd{t} = F(t_2) - F(t_1)
\end{equation}
And so we get:
\begin{equation}
    \delta \tilde{S} = \delta S + \crossout{\delta(F(t_2) - F(t_1))}
\end{equation}
The variation between the values of $F$ is obviously zero since their difference is just a constant number that comes from the integral. So if \hpquotemath\;holds for $\lagr$ we have:
\begin{equation}
    \delta \tilde{S} = \delta S = 0
\end{equation}
And so $\tilde{\lagr}$ is a Lagrangian for the system.\\
\section{Examples (WIP)}
\section{The energy function}
Let's now discuss the energy of a system. The Lagrangian $\lagr$ has the dimensions of an energy, but it \underline{is not} the total energy.
\begin{equation}
    \lagr = T - V \cancel{\Leftrightarrow} E = T + V
\end{equation}
We can evaluate the derivative of the Lagrangian and see what we get:
\begin{equation}
    \dfrac{\dd{\lagr}}{\dd{t}} = \bigsum_{\alpha}\brackets{\pdv{\lagr}{q_{\alpha}}\dot{q}_{\alpha} + \pdv{\lagr}{\dot{q}_{\alpha}}\ddot{q}_{\alpha}} + \dfrac{\partial \lagr}{\partial t}
\end{equation}
If \eleref\;hold then we have:
\begin{equation}
    \dfrac{\dd{\lagr}}{\dd{t}} = \bigsum_{\alpha}\underbrace{\left[\dv{}{t}\brackets{\pdv{\lagr}{\dot{q}_{\alpha}}}\dot{q}_{\alpha} + \pdv{\lagr}{\dot{q}_{\alpha}}\ddot{q}_{\alpha}\right]}_{\text{total time derivative}} + \dfrac{\partial \lagr}{\partial t} =
\end{equation}
\begin{equation}
 = \dv{}{t}\bigsum_{\alpha}\pdv{\lagr}{\dot{q}_{\alpha}}\dot{q}_{\alpha} + \dfrac{\partial \lagr}{\partial t}
\end{equation}
So in general:
\begin{equation}
    \dfrac{\dd{\lagr}}{\dd{t}} \neq 0
\end{equation}
even if the partial derivative of $\lagr$ with respect to time is zero. But we can define a quantity $h$ called \textbf{energy function}:
\begin{equation}
    h \defineeq \bigsum_{\alpha}\pdv{\lagr}{\dot{q}_{\alpha}}\dot{q}_{\alpha} - \lagr
\end{equation}
and so we have:
\begin{equation}
    \dfrac{\dd{h}}{\dd{t}} = -\dfrac{\partial \lagr}{\partial t}
\end{equation}
Obviously $h$ is a constant of motion if and only if the partial derivative with respect to time of the Lagrangian is 0:
\begin{equation}
    h\;\text{is conserved} \iff \dfrac{\dd{h}}{\dd{t}} = 0 \iff \dfrac{\partial \lagr}{\partial t} = 0
\end{equation}
Saying that $\lagr$ does not depend on time explicitly means that the potential $V$ does not depend on time and also:
\begin{itemize}
    \item Constraints depending on time $\Rightarrow$ $\lagr$ depends on time
    \item Constraints not depending on time $\Rightarrow$ $\lagr$ does not depend on time
\end{itemize}
Now we want to prove that $h$ is the total energy if these conditions hold:
\begin{enumerate}
    \item Transformation equations do not depend on time
    \item The potential $V$ does not depend on time
\end{enumerate}
Let's further analyse condition (1). Writing the kinetic energy $T$ we get:
\begin{equation}
    T = \dfrac{1}{2}\bigsum_i m_i v_i^2 = \dfrac{1}{2}\bigsum_i m_i \dvec{r}_i \cdot \dvec{r}_i
\end{equation}
The time derivative of $r_i(q_{\alpha},t)$ is:
\begin{equation}
    \dvec{r}_i = \dfrac{\dd{\vec{r}_i}}{\dd{t}} = \bigsum_{\alpha}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\dot{q}_{\alpha} + \dfrac{\partial \vec{r}_i}{\partial t}
\end{equation}
Hence we have:
\begin{equation}
    T = \dfrac{1}{2}\bigsum_i m_i \left[\bigsum_{\alpha}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\dot{q}_{\alpha} + \dfrac{\partial \vec{r}_i}{\partial t}\right] \cdot \left[\bigsum_{\beta}\dfrac{\partial \vec{r}_i}{\partial q_{\beta}}\dot{q}_{\beta} + \dfrac{\partial \vec{r}_i}{\partial t}\right] =
\end{equation}

\begin{equation}
    \begin{split}
        = \dfrac{1}{2}\bigsum_i m_i \bigsum_{\alpha}\bigsum_{\beta}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\cdot\dfrac{\partial \vec{r}_i}{\partial q_{\beta}}\dot{q}_{\alpha}\dot{q}_{\beta} + \dfrac{1}{2}\bigsum_i m_i \dfrac{\partial \vec{r}_i}{\partial t} \cdot \dfrac{\partial \vec{r}_i}{\partial t} +\\
        + \dfrac{1}{2}\bigsum_i m_i \bigsum_{\alpha}\dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} \cdot \dfrac{\partial \vec{r}_i}{\partial t} \dot{q}_{\alpha} + \dfrac{1}{2}\bigsum_i m_i \bigsum_{\beta}\dfrac{\partial \vec{r}_i}{\partial q_{\beta}} \cdot \dfrac{\partial \vec{r}_i}{\partial t}\dot{q}_{\beta}
    \end{split}
\end{equation}
The terms on the second line are actually the same since summing over $\alpha$ or $\beta$ is actually the same. Let us now define some quantities for a shorter notation:
\begin{equation}
    \begin{split}
        T_{\alpha \beta} \defineeq \bigsum_i m_i \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}}\cdot\dfrac{\partial \vec{r}_i}{\partial q_{\beta}}\\
        T_{\alpha} \defineeq \dfrac{1}{2} \bigsum_i m_i \dfrac{\partial \vec{r}_i}{\partial q_{\alpha}} \cdot \boxed{\dfrac{\partial \vec{r}_i}{\partial t}}\\
        T_0 \defineeq \dfrac{1}{2}\bigsum_i m_i \boxed{\dfrac{\partial \vec{r}_i}{\partial t} \cdot \dfrac{\partial \vec{r}_i}{\partial t}}
    \end{split}
\end{equation}
The quantities $T_{\alpha}$ and $T_0$ are zero if the transformation equations do not depend on time explicitly since the partial derivative with respect to time of $\vec{r}_i$ is zero. Rewriting the kinetic energy we have:
\begin{equation}
    T = \dfrac{1}{2}\bigsum_{\alpha}\bigsum_{\beta}T_{\alpha \beta}\dot{q}_{\alpha}\dot{q}_{\beta} + \crossout{\bigsum_{\alpha}T_{\alpha}\dot{q}_{\alpha}} + \crossout{T_0}
\end{equation}
\begin{equation} \label{e:kinetic_energy}
    T = \dfrac{1}{2}\bigsum_{\alpha}\bigsum_{\beta}T_{\alpha \beta}\dot{q}_{\alpha}\dot{q}_{\beta}
\end{equation}
And so $T$ is a quadratic function of the generalized velocities.\\
Now let's analyse condition (2). To start we can remember this:
\begin{equation}
    \pdv{\lagr}{\dot{q}_{\alpha}} = \dfrac{\partial T}{\partial \dot{q}_{\alpha}} - \crossout{\partial{V}{\dot{q}_{\alpha}}}
\end{equation}
since $V$ does not depend on the generalized velocities. Now substituting \eqref{e:kinetic_energy} we get:
\begin{equation}
    h = \bigsum_{\gamma}\dfrac{\partial T}{\partial \dot{q}_{\gamma}} - \lagr = \bigsum_{\gamma}\dfrac{\partial}{\partial \dot{q}_{\gamma}}\bigg(\dfrac{1}{2}\bigsum_{\alpha}\bigsum_{\beta}\underbrace{T_{\alpha \beta}}_{\cancel{\propto} \dot{q}_{\alpha}, \dot{q}_{\beta}}\dot{q}_{\alpha}\dot{q}_{\beta}\bigg)  - \lagr =
\end{equation}
We can bring the partial derivative inside the sum:
\begin{equation}
    h = \dfrac{1}{2}\bigsum_{\gamma}\bigsum_{\alpha}\bigsum_{\beta}T_{\alpha \beta}\bigg(\underbrace{\dfrac{\partial \dot{q}_{\alpha}}{\partial \dot{q}_{\gamma}}}_{\delta_{\alpha \gamma}}\dot{q}_{\beta} + \underbrace{\dfrac{\partial \dot{q}_{\beta}}{\partial \dot{q}_{\gamma}}}_{\delta_{\beta \gamma}}\dot{q}_{\alpha}\bigg) - \lagr
\end{equation}
If we split out the terms of the sum we can cancel out the sum over $\alpha$ in the first term due to the Kronecker delta. Similarly, we can cancel out the sum over $\beta$. We need to remind that we also need to switch the cancelled indexes with $\gamma$ since those are the remaining terms.
\begin{equation}
    \bigsum_{\gamma}\cancel{\bigsum_{\alpha}}\bigsum_{\beta}T_{\alpha \beta }\cancel{\delta_{\alpha \gamma}}\dot{q}_{\beta} = \bigsum_{\gamma}\bigsum_{\beta}T_{\gamma \beta }\dot{q}_{\beta}
\end{equation}
So we get:
\begin{equation}
    h = \underbrace{\dfrac{1}{2}\bigsum_{\gamma}\bigsum_{\beta}T_{\gamma \beta }\dot{q}_{\beta}}_{T} + \underbrace{\dfrac{1}{2}\bigsum_{\gamma}\bigsum_{\alpha}T_{\gamma \alpha }\dot{q}_{\alpha}}_{T} - \lagr = 2T - (T-V) = T + V = E
\end{equation}
And so conditions (1) and (2) really are the conditions for $h$ to be the total energy of the system $E$. The conditions for $h$ to be the energy and for $h$ to be conserved do not necessarily match, so we can have all the possible cases:
\begin{itemize}
    \item $h$ is the energy and it is conserved
    \item $h$ is the energy but it is not conserved
    \item $h$ is not the energy but it is conserved
    \item $h$ is not the energy and it is not conserved
\end{itemize}
\section{Conservation of the total linear momentum}
Let's now talk about the conservation of linear momenta. In the Lagrange formalism the role of linear momentum is done by the \textbf{generalized momentum} conjugate to $q_{\alpha}$:
\begin{equation}
    p_{\alpha} \defineeq \pdv{\lagr}{\dot{q}_{\alpha}}
\end{equation}
which can also be called \textbf{canonical momentum}. The generalized momentum may not correspond to the linear momentum we get from Newton's equations. We can show that for an easy example the two quantities correspond.\\
Let's define the Lagrangian as:
\begin{equation}
    \lagr = \dfrac{1}{2}m(\dot{x}^2 + \dot{y}^2 + \dot{z}^2) - V(x,y,z)
\end{equation}
This might be an example for an easy "Physics I-like" system (for example a falling object). We evaluate the generalized momentum conjugate to x and get:
\begin{equation}
    p_x = \dfrac{\partial \lagr}{\partial \dot{x}} = m\dot{x}
\end{equation}
which is indeed the linear momentum found by using Newton's equations.\\
If we go back to \eleref\;and \lagrangeref\;we can identify the term $p_{\alpha}$ inside those equations. If they hold (remember we need to ask for a potential independent of the velocities) then we can write:
\begin{equation}
    \dfrac{\dd{p_{\alpha}}}{\dd{t}} = \pdv{\lagr}{q_{\alpha}} \Rightarrow \dot{p}_{\alpha} = \pdv{\lagr}{q_{\alpha}}
\end{equation}
If only the potential does depend on the coordinates and $T$ does not then we can also write:
\begin{equation}
    \dot{p}_{\alpha} = \pdv{[\cancel{T}-V]}{q_{\alpha}} = -\pdv{V}{q_{\alpha}}
\end{equation}
If $V$ does not depend on the velocities we also have:
\begin{equation}
    -\pdv{V}{q_{\alpha}} = Q_{\alpha}
\end{equation}
\begin{equation}
    \boxed{\dot{p}_{\alpha} = Q_{\alpha}}
\end{equation}
This is the corresponding relation for $\vec{F} = \dvec{p}$ in Newton's equations. If $V$ depends on $\dot{q}_{\alpha}$ we get:
\begin{equation}
    \dv{}{t}\pdv{V}{\dot{q}_{\alpha}}-\pdv{V}{q_{\alpha}} = Q_{\alpha}
\end{equation}
Let us now define what \textbf{cyclic coordinates} are.
\begin{equation}
    q_{\alpha}\;\text{is cyclic} \iff \pdv{\lagr}{q_{\alpha}} = 0
\end{equation}
If $q_{\alpha}$ is cyclic and \eleref\;are true we have:
\begin{equation}
    \dv{}{t} \pdv{\lagr}{\dot{q}_j} - \crossout{\pdv{\lagr}{q_{\alpha}}} = 0
\end{equation}
\begin{equation}
    \dot{p}_{\alpha} = 0
\end{equation}
This means that if a coordinate is cyclic its corresponding generalized momentum is conserved.\\
Now let $q_j$ be a \textbf{collective coordinate} such that $\delta q_j$ represents an infinitesimal displacement of the system \underline{as a whole}.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\linewidth]{res/svg/collectivecoord.drawio}
    \caption{Collective coordinate}
\end{figure}
If this is the case all the particles are moving parallel to a single unit vector $\hat{u}$:
\begin{equation}
    \hat{u} = \dfrac{\partial \vec{r}_i}{\partial q_j}
\end{equation}
\begin{equation}
    \delta \vec{r}_i = \delta q_j \hat{u}
\end{equation}
Also $q_j$ cannot appear in the expression of $T$, hence:
\begin{equation}
    \pdv{T}{q_j}=0
\end{equation}
Changing $q_j$ is a translation that leaves everything untouched (like moving the origini of the axis). Now consider $V=V(q_{\alpha},\cancel{\dot{q}_{\alpha}},t)$:
\begin{equation}
    -\pdv{V}{q_{\alpha}} = Q_{\alpha}
\end{equation}
Let's consider \eleref\;for $q_j$:
\begin{equation}
    \dv{}{t}\underbrace{\pdv{\lagr}{\dot{q}_j}}_{p_j} - \underbrace{\pdv{\lagr}{q_j}}_{-\frac{\partial V}{\partial q_j}} = 0
\end{equation}
\begin{equation} \label{e:ele_for_qj}
    \dv{}{t}p_j = -\pdv{V}{q_j} = Q_j
\end{equation}
Remembering the definition of $Q_j$:
\begin{equation}
    Q_j = \bigsum_i \vec{F}_i \cdot \underbrace{\pdv{\vec{r}_i}{q_j}}_{\hat{u}} = \vec{F}\cdot \hat{u}
\end{equation}
Similarly from the definition of $p_j$:
\begin{equation}
    p_j = \pdv{\lagr}{\dot{q}_j} = \pdv{}{\dot{q}_j}\brackets{\dfrac{1}{2}\bigsum_i m_i \vec{r}_i^{\;2}} = \dfrac{1}{2}\bigsum_i m_i \pdv{}{\dot{q}_j}(\vec{r}_i^2) = \bigsum_i m_i \vec{r}_i \cdot \underbrace{\pdv{\vec{r}_i}{\dot{q}_j}}_{\hat{u}}
\end{equation}
\begin{equation}
    p_j = \vec{P}\cdot\hat{u}
\end{equation}
Going back to \eqref{e:ele_for_qj}:
\begin{equation}
    \dv{}{t}(\vec{P}\cdot\hat{u}) = \vec{F}\cdot \hat{u}
\end{equation}
If $q_j$ is also a cyclic coordinate we have:
\begin{equation}
    \pdv{\lagr}{q_j} = 0 \Rightarrow \pdv{[\cancel{T}-V]}{q_j} = \pdv{V}{q_j} = 0
\end{equation}
From this immediately follows:
\begin{equation}
    Q_j = 0 \Rightarrow \dv{}{t}(p_j) = \dv{}{t}(\vec{P}\cdot\hat{u}) = 0
\end{equation}
So if $q_j$ is a cyclic and collective coordinate the generalized momentum conjugate to $q_j$ si conserved.
\section{Conservation of the total angular momentum}
Let's consider a specific coordinate $q_j$ such that $\delta q_j$ is a rigid rotation of the system as a whole, about a certain axis as shown:
\\\textbf{IMAGE}\\
We can see that $\delta \vec{r}_i$ is a tangential displacement. If we use the angle $\theta$ as our coordinate we can write:
\begin{equation}
    \dv{\vec{r}_i}{t} = \dv{\theta}{t} \hat{u} \wedge \vec{r}_i = \dot{q}_j \hat{u} \wedge \vec{r}_i
\end{equation}
From which follows:
\begin{equation}
    \delta \vec{r}_i = \delta q_j \hat{u} \wedge \vec{r}_i \Rightarrow \pdv{\vec{r}_i}{q_j} = \hat{u} \wedge \vec{r}_i
\end{equation}
Also $q_j$ cannot appear in the expression of $T$, hence:
\begin{equation}
    \pdv{T}{q_j} = 0
\end{equation}
Now we consider a system such that $V = V(q_{\alpha},\cancel{\dot{q}_{\alpha}},t)$ and write \eleref\;for $q_j$:
\begin{equation} \label{e:ele_for_angular_momentum}
    \begin{split}
        \dv{}{t}\pdv{\lagr}{\dot{q}_j} - \pdv{\lagr}{q_j} = 0\\
        \dv{}{t}\underbrace{\pdv{T}{\dot{q}_j}}_{p_j} - \bigg(\underbrace{- \pdv{V}{q_j}}_{Q_j}\bigg) = 0
    \end{split}
\end{equation}
Let's explicitly write $Q_j$:
\begin{equation}
    Q_j = \bigsum_i \vec{F}_i \cdot \pdv{\vec{r}_i}{q_j} = \bigsum_i \vec{F}_i \cdot \hat{u} \wedge \vec{r}_i
\end{equation}
Inside the summation we have a triple product, hence we can exploit the fact that $\hat{u}$ does not depend on $i$ and also the invariance of the triple product with respect to circular shifts:
\begin{equation}
    \vec{a} \cdot \vec{b} \wedge \vec{c} = \vec{c} \cdot \vec{a} \wedge \vec{b} = \vec{b} \cdot \vec{c} \wedge \vec{a}
\end{equation}
And so we get:
\begin{equation}
    Q_j = \hat{u} \cdot \underbrace{\bigsum_i \vec{r}_i \wedge \vec{F}_i}_{\vec{\tau}} = \hat{u} \cdot \vec{\tau}
\end{equation}
Now let's analyse the partial derivative of the kinetic energy:
\begin{equation}
    \pdv{T}{\dot{q}_j} = \pdv{}{\dot{q}_j}\brackets{\dfrac{1}{2}\bigsum_i m_i \vec{r}_i^{\;2}} = \bigsum_i m_i \vec{r}_i \cdot \pdv{\vec{r}_i}{\dot{q}_j} = \bigsum_i m_i \vec{r}_i \cdot \hat{u} \wedge \vec{r}_i
\end{equation}
Again we exploit the properties of the triple product and get:
\begin{equation}
    \pdv{T}{\dot{q}_j} =   \hat{u} \cdot \underbrace{\bigsum_i \vec{r}_i \wedge m_i \vec{r}_i}_{\vec{L}_0} = \hat{u} \cdot \vec{L}_0
\end{equation}
Finally we can substitute back into \eqref{e:ele_for_angular_momentum}:
\begin{equation}
    \dv{}{t}\brackets{\vec{L}_0 \cdot \hat{u}} = \vec{\tau} \cdot \hat{u}
\end{equation}
This means that if the total torque about a generic axis is zero, then the total angular momentum about that axis is conserved. For example if we let $\hat{u} = \hat{z}$:
\begin{equation}
    \tau_z = 0 \Rightarrow L_z\;\text{is conserved}
\end{equation}
We then notice that if $q_j$ is a cyclic coordinate we have:
\begin{equation}
    Q_j = -\pdv{V}{q_j} = 0 \Rightarrow \vec{\tau} \cdot \hat{u} = 0 \Rightarrow \vec{L}_0 \cdot \hat{u}\;\text{is conserved}
\end{equation}
\section{Noether's theorem}
In the last two sections we arrived to these conclusions:
\begin{itemize}
    \item The conservation of the total momentum is due to an invariance of $\lagr$ to translations
    \item The conservation of the momentum along an axis is due to an invariance of $\lagr$ to translation along that axis
    \item The conservation of the total angular momentum is due to an invariance of $\lagr$ to rotations
    \item The conservation of the angular momentum along an axis is due to an invariance of $\lagr$ to rotations along that axis
    \item If $\lagr$ is invariant with respect to time the energy function is conserved
\end{itemize}
We can easily see the "pattern" arising from those conclusions. Those are all examples of the \textbf{Noether's theorem} which can be stated as:
\begin{quotation}
    \textit{For every invariance of $\lagr$ there is a conserved quantity}
\end{quotation}
